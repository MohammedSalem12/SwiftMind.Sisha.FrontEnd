<div class="attendance-page card">
  <h2>Mark Attendance / Absences</h2>

  <!-- Absent Counter -->
  <div class="absent-counter" *ngIf="selectedCourseId()">
    <div class="counter-card">
      <span class="counter-label">الغائبون اليوم:</span>
      <span class="counter-value">{{ absentCount() }}</span>
      <span class="counter-total">من {{ students().length }}</span>
    </div>
  </div>

  <div class="controls">
    <!-- Teacher selection hidden - using current user automatically -->
    <div>
      <label>Course</label>
      <select [ngModel]="selectedCourseId()" (ngModelChange)="onCourseChange($event)">
        <option value="">-- اختر المقرر --</option>
        <option *ngFor="let c of courses()" [value]="c.id">{{ (c.nameEn || c.nameAr) + (c.gradeName ? ' - ' + c.gradeName : '') }}</option>
      </select>
    </div>
    <div>
      <label>Date</label>
      <input type="date" [ngModel]="attendanceDate()" (ngModelChange)="setDateAndReload($event)" />
    </div>
    <div style="flex:1">
  <!-- Note removed from UI; notes are fixed to "--" -->
    </div>
  </div>

  <div class="students-list">
    <div *ngIf="!selectedCourseId()" class="no-data info-message">
      <i class="fas fa-info-circle"></i>
      يرجى اختيار مقرر لعرض الطلاب المسجلين
    </div>
    <div *ngIf="selectedCourseId() && students().length === 0" class="no-data">لا يوجد طلاب مسجلين في هذا المقرر</div>
    <table *ngIf="students().length > 0" class="table table-sm">
      <thead>
        <tr>
          <th>#</th>
          <th>Student</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let s of students(); let i = index" [class.absent-row]="s.alreadyAbsent">
          <td>{{ i + 1 }}</td>
          <td class="student-cell">
            <img class="student-avatar" src="/assets/images/avatar-placeholder.png" alt="avatar" />
            <span>{{ s.studentName }}</span>
          </td>
          <td>
            <span class="status-badge" [class.status-absent]="s.alreadyAbsent" [class.status-present]="!s.alreadyAbsent">
              <i class="fas" [class.fa-times-circle]="s.alreadyAbsent" [class.fa-check-circle]="!s.alreadyAbsent"></i>
              {{ s.alreadyAbsent ? 'غائب' : 'حاضر' }}
            </span>
          </td>
          <td>
            
            <button 
              class="btn btn-sm" 
              [class.btn-danger]="!s.alreadyAbsent" 
              [class.btn-success]="s.alreadyAbsent" 
              (click)="toggleAttendance(s.enrollmentId, s.alreadyAbsent)" 
              [disabled]="saving()">
              <i class="fas" [class.fa-user-times]="!s.alreadyAbsent" [class.fa-user-check]="s.alreadyAbsent"></i>
              {{ s.alreadyAbsent ? 'إلغاء الغياب' : 'تسجيل غياب' }}
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- <div class="absentees-table card mt-3" *ngIf="todaysAbsentees().length > 0">
    <div class="card-body">
      <h5 class="mb-3">غائبون اليوم ({{ attendanceDate() }}) <span class="badge bg-light text-dark">{{ todaysAbsentees().length }}</span></h5>
      <table class="table table-sm">
        <thead>
          <tr>
            <th>#</th>
            <th>Student</th>
            <th>Note</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let a of todaysAbsentees(); let i = index">
            <td>{{ i + 1 }}</td>
            <td class="student-cell">
              <img class="student-avatar" src="/assets/images/avatar-placeholder.png" alt="avatar" />
              <span>{{ a.studentName }}</span>
            </td>
            <td>{{ '--' }}</td>
            <td><button class="btn btn-sm btn-outline-danger" (click)="cancelAttendance(a.attendanceId, a.enrollmentId)" [disabled]="deletingAttendanceId() === (a.attendanceId || a.enrollmentId)">Cancel</button></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div> -->

  <div class="actions">
    <!-- <button class="mark-btn" (click)="markAttendances()" [class.loading]="saving()" [disabled]="saving() || students().length === 0">
      <svg *ngIf="!saving()" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M9 11l3 3L22 4" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h11" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span *ngIf="!saving()">تسجيل الغياب</span>
      <span class="spinner" *ngIf="saving()" aria-hidden="true"></span>
    </button> -->
    <div class="message" *ngIf="message()">{{ message() }}</div>
  </div>
</div>
